clearvars;
close all;

% Тестовый расчёт тестового спектра
Lambda = [360	380	400	420	440	460	480	500	520	540	560	580	600	620	640	660	680	700	720	740	760	780	800	820];
I = [56.1200000000000	57.9200000000000	58.8200000000000	58.9700000000000	58.5000000000000	57.5200000000000	56.1500000000000	54.4800000000000	52.6100000000000	50.5900000000000	48.4800000000000	46.3400000000000	44.1800000000000	42.0500000000000	39.9600000000000	37.9300000000000	35.9700000000000	34.0800000000000	32.2700000000000	30.5500000000000	28.9100000000000	27.3600000000000	25.8800000000000	24.4900000000000];
x_curve = [0.000130000000000000	0.00136800000000000	0.0143100000000000	0.134380000000000	0.348280000000000	0.290800000000000	0.0956400000000000	0.00490000000000000	0.0632700000000000	0.290400000000000	0.594500000000000	0.916300000000000	1.06220000000000	0.854450000000000	0.447900000000000	0.164900000000000	0.0467700000000000	0.0113590000000000	0.00289900000000000	0.000690000000000000	0.000166000000000000	4.20000000000000e-05	1.00000000000000e-05	3.00000000000000e-06];
y_curve = [4.00000000000000e-06	3.90000000000000e-05	0.000396000000000000	0.00400000000000000	0.0230000000000000	0.0600000000000000	0.139020000000000	0.323000000000000	0.710000000000000	0.954000000000000	0.995000000000000	0.870000000000000	0.631000000000000	0.381000000000000	0.175000000000000	0.0610000000000000	0.0170000000000000	0.00410200000000000	0.00104700000000000	0.000249000000000000	6.00000000000000e-05	1.50000000000000e-05	4.00000000000000e-06	1.00000000000000e-06];
z_curve = [0.000606000000000000	0.00645000000000000	0.0678500000000000	0.645600000000000	1.74706000000000	1.66920000000000	0.812950000000000	0.272000000000000	0.0782500000000000	0.0203000000000000	0.00390000000000000	0.00165000000000000	0.000800000000000000	0.000190000000000000	2.00000000000000e-05	0	0	0	0	0	0	0	0	0];

%% XYZ
kc = 100/trapz(Lambda, I.*y_curve);
X = kc * trapz(Lambda, I.*x_curve);
Y = kc * trapz(Lambda, I.*y_curve);
Z = kc * trapz(Lambda, I.*z_curve);
x = X/(X+Y+Z);
y = Y/(X+Y+Z);

%% Lu'v'
Luv = Y;
u = 4*X/(X+15*Y+3*Z);
v = 9*Y/(X+15*Y+3*Z);

%% L*a*b*
X_D50 = 96.422;
Y_D50 = 100;
Z_D50 = 82.521;
if (X/X_D50) > 0.00885645
    fx = (X/X_D50)^(1/3);
else
    fx = (903.3*X/X_D50+16)/116;
end
if (Y/Y_D50) > 0.00885645
    fy = (Y/Y_D50)^(1/3);
else
    fy = (903.3*Y/Y_D50+16)/116;
end
if (Z/Z_D50) > 0.00885645
    fz = (Z/Z_D50)^(1/3);
else
    fz = (903.3*Z/Z_D50+16)/116;
end
Lab = 116*fy-16;
a = 500*(fx-fy);
b = 200*(fy-fz);

%% КТЦ
c = 3e8;
h = 6.6262e-34;
k = 1.38067e-23;
LL = Lambda*1e-9;
M = 2*h*c^2./(LL.^5.*(exp(h*c./(LL*k*6000))-1));